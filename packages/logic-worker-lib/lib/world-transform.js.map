{"version":3,"file":"world-transform.js","sourceRoot":"","sources":["../src/world-transform.ts"],"names":[],"mappings":"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","sourcesContent":["import { ObjectStateTree } from '@hydraengine/shared'\nimport { LocalTransform } from './local-transform'\n\nexport class WorldTransform {\n  #id?: number\n  #stateTree?: ObjectStateTree\n\n  #x = Number.NEGATIVE_INFINITY\n  #y = Number.NEGATIVE_INFINITY\n  #scaleX = 1\n  #scaleY = 1\n  #rotation = 0\n\n  cos = 1\n  sin = 0\n\n  get x() { return this.#x }\n  set x(v) {\n    if (this.#x !== v) {\n      this.#x = v\n\n      const id = this.#id\n      const tree = this.#stateTree\n      if (tree && id !== undefined) {\n        tree.setWorldX(id, v)\n      }\n    }\n  }\n\n  get y() { return this.#y }\n  set y(v) {\n    if (this.#y !== v) {\n      this.#y = v\n\n      const id = this.#id\n      const tree = this.#stateTree\n      if (tree && id !== undefined) {\n        tree.setWorldY(id, v)\n      }\n    }\n  }\n\n  get scaleX() { return this.#scaleX }\n  set scaleX(v) {\n    if (this.#scaleX !== v) {\n      this.#scaleX = v\n\n      const id = this.#id\n      const tree = this.#stateTree\n      if (tree && id !== undefined) {\n        tree.setWorldScaleX(id, v)\n      }\n    }\n  }\n\n  get scaleY() { return this.#scaleY }\n  set scaleY(v) {\n    if (this.#scaleY !== v) {\n      this.#scaleY = v\n\n      const id = this.#id\n      const tree = this.#stateTree\n      if (tree && id !== undefined) {\n        tree.setWorldScaleY(id, v)\n      }\n    }\n  }\n\n  get rotation() { return this.#rotation }\n  set rotation(v) {\n    if (this.#rotation !== v) {\n      this.#rotation = v\n\n      const cos = Math.cos(v)\n      const sin = Math.sin(v)\n      this.cos = cos\n      this.sin = sin\n\n      const id = this.#id\n      const tree = this.#stateTree\n      if (tree && id !== undefined) {\n        tree.setWorldRotation(id, v)\n        tree.setWorldCos(id, cos)\n        tree.setWorldSin(id, sin)\n      }\n    }\n  }\n\n  update(parent: WorldTransform, local: LocalTransform) {\n    const rx = local.x * parent.scaleX\n    const ry = local.y * parent.scaleY\n    const pCos = parent.cos\n    const pSin = parent.sin\n\n    this.scaleX = parent.scaleX * local.scaleX\n    this.scaleY = parent.scaleY * local.scaleY\n\n    const pivotX = local.pivotX * this.scaleX\n    const pivotY = local.pivotY * this.scaleY\n    const cos = local.cos\n    const sin = local.sin\n\n    this.x = parent.x + (rx * pCos - ry * pSin) - (pivotX * cos - pivotY * sin)\n    this.y = parent.y + (rx * pSin + ry * pCos) - (pivotX * sin + pivotY * cos)\n\n    this.rotation = parent.rotation + local.rotation\n  }\n\n  setStateTree(id: number, tree: ObjectStateTree) {\n    this.#id = id\n    this.#stateTree = tree\n\n    tree.setWorldX(id, this.#x)\n    tree.setWorldY(id, this.#y)\n    tree.setWorldScaleX(id, this.#scaleX)\n    tree.setWorldScaleY(id, this.#scaleY)\n    tree.setWorldRotation(id, this.#rotation)\n    tree.setWorldCos(id, this.cos)\n    tree.setWorldSin(id, this.sin)\n  }\n\n  clearStateTree() {\n    this.#id = undefined\n    this.#stateTree = undefined\n  }\n}\n"]}