{"version":3,"file":"game-object.js","sourceRoot":"","sources":["../../src/object/game-object.ts"],"names":[],"mappings":"AAAA,OAAO,EAAmB,UAAU,EAAE,MAAM,qBAAqB,CAAA;AACjE,OAAO,EAAE,cAAc,EAAE,MAAM,oBAAoB,CAAA;AACnD,OAAO,EAAE,cAAc,EAAE,MAAM,oBAAoB,CAAA;AAOnD,MAAM,OAAO,UAAU;IACrB,IAAI,GAAG,UAAU,CAAC,UAAU,CAAA;IAE5B,GAAG,CAAS;IACZ,UAAU,CAAkB;IAE5B,OAAO,CAAa;IACpB,SAAS,GAAiB,EAAE,CAAA;IAE5B,eAAe,GAAG,IAAI,cAAc,EAAE,CAAA;IACtC,eAAe,GAAG,IAAI,cAAc,EAAE,CAAA;IACtC,KAAK,GAAG,CAAC,CAAA;IACT,WAAW,GAAG,CAAC,CAAA;IAEL,WAAW,CAAC,EAAU,EAAE,SAA0B;QAC1D,IAAI,CAAC,GAAG,GAAG,EAAE,CAAA;QACb,IAAI,CAAC,UAAU,GAAG,SAAS,CAAA;QAC3B,IAAI,CAAC,eAAe,CAAC,CAAC,GAAG,CAAC,CAAA;QAC1B,IAAI,CAAC,eAAe,CAAC,CAAC,GAAG,CAAC,CAAA;IAC5B,CAAC;IAED,YAAY,OAA2B;QACrC,IAAI,OAAO,EAAE,CAAC;YACZ,IAAI,OAAO,CAAC,CAAC,KAAK,SAAS;gBAAE,IAAI,CAAC,CAAC,GAAG,OAAO,CAAC,CAAC,CAAA;YAC/C,IAAI,OAAO,CAAC,CAAC,KAAK,SAAS;gBAAE,IAAI,CAAC,CAAC,GAAG,OAAO,CAAC,CAAC,CAAA;QACjD,CAAC;IACH,CAAC;IAES,iBAAiB,CAAC,QAAgB,EAAE,SAA0B;QACtE,IAAI,CAAC,oBAAoB,EAAE,CAAA;QAE3B,MAAM,EAAE,GAAG,SAAS,CAAC,QAAQ,CAAC,QAAQ,CAAC,CAAA;QACvC,SAAS,CAAC,aAAa,CAAC,EAAE,EAAE,IAAI,CAAC,IAAI,CAAC,CAAA;QACtC,SAAS,CAAC,aAAa,CAAC,EAAE,EAAE,IAAI,CAAC,KAAK,CAAC,CAAA;QAEvC,IAAI,CAAC,GAAG,GAAG,EAAE,CAAA;QACb,IAAI,CAAC,UAAU,GAAG,SAAS,CAAA;QAC3B,IAAI,CAAC,eAAe,CAAC,YAAY,CAAC,EAAE,EAAE,SAAS,CAAC,CAAA;QAChD,IAAI,CAAC,eAAe,CAAC,YAAY,CAAC,EAAE,EAAE,SAAS,CAAC,CAAA;QAEhD,KAAK,MAAM,KAAK,IAAI,IAAI,CAAC,SAAS,EAAE,CAAC;YACnC,KAAK,CAAC,iBAAiB,CAAC,EAAE,EAAE,SAAS,CAAC,CAAA;QACxC,CAAC;QAED,OAAO,EAAE,CAAA;IACX,CAAC;IAED,oBAAoB;QAClB,IAAI,IAAI,CAAC,GAAG,KAAK,SAAS,IAAI,IAAI,CAAC,UAAU;YAAE,IAAI,CAAC,UAAU,CAAC,MAAM,CAAC,IAAI,CAAC,GAAG,CAAC,CAAA;QAC/E,IAAI,CAAC,GAAG,GAAG,SAAS,CAAA;QACpB,IAAI,CAAC,UAAU,GAAG,SAAS,CAAA;QAC3B,IAAI,CAAC,eAAe,CAAC,cAAc,EAAE,CAAA;QACrC,IAAI,CAAC,eAAe,CAAC,cAAc,EAAE,CAAA;IACvC,CAAC;IAED,GAAG,CAAC,GAAG,QAAsB;QAC3B,KAAK,MAAM,KAAK,IAAI,QAAQ,EAAE,CAAC;YAE7B,IAAI,KAAK,CAAC,OAAO,EAAE,CAAC;gBAClB,MAAM,GAAG,GAAG,KAAK,CAAC,OAAO,CAAC,SAAS,CAAC,OAAO,CAAC,KAAK,CAAC,CAAA;gBAClD,IAAI,GAAG,KAAK,CAAC,CAAC;oBAAE,KAAK,CAAC,OAAO,CAAC,SAAS,CAAC,MAAM,CAAC,GAAG,EAAE,CAAC,CAAC,CAAA;YACxD,CAAC;YAED,KAAK,CAAC,OAAO,GAAG,IAAI,CAAA;YACpB,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,KAAK,CAAC,CAAA;YAE1B,IAAI,IAAI,CAAC,GAAG,KAAK,SAAS,IAAI,IAAI,CAAC,UAAU,EAAE,CAAC;gBAC9C,KAAK,CAAC,iBAAiB,CAAC,IAAI,CAAC,GAAG,EAAE,IAAI,CAAC,UAAU,CAAC,CAAA;YACpD,CAAC;QACH,CAAC;IACH,CAAC;IAED,MAAM;QACJ,IAAI,CAAC,oBAAoB,EAAE,CAAA;QAE3B,IAAI,IAAI,CAAC,OAAO,EAAE,CAAC;YACjB,MAAM,GAAG,GAAG,IAAI,CAAC,OAAO,CAAC,SAAS,CAAC,OAAO,CAAC,IAAI,CAAC,CAAA;YAChD,IAAI,GAAG,KAAK,CAAC,CAAC;gBAAE,IAAI,CAAC,OAAO,CAAC,SAAS,CAAC,MAAM,CAAC,GAAG,EAAE,CAAC,CAAC,CAAA;YACrD,IAAI,CAAC,OAAO,GAAG,SAAS,CAAA;QAC1B,CAAC;QAED,KAAK,MAAM,KAAK,IAAI,IAAI,CAAC,SAAS,EAAE,CAAC;YACnC,KAAK,CAAC,OAAO,GAAG,SAAS,CAAA;YACzB,KAAK,CAAC,MAAM,EAAE,CAAA;QAChB,CAAC;QACD,IAAI,CAAC,SAAS,CAAC,MAAM,GAAG,CAAC,CAAA;IAC3B,CAAC;IAED,MAAM,CAAC,EAAU;QACf,KAAK,MAAM,KAAK,IAAI,IAAI,CAAC,SAAS,EAAE,CAAC;YACnC,KAAK,CAAC,MAAM,CAAC,EAAE,CAAC,CAAA;QAClB,CAAC;IACH,CAAC;IAED,oBAAoB;QAClB,IAAI,IAAI,CAAC,OAAO,EAAE,CAAC;YACjB,IAAI,CAAC,eAAe,CAAC,MAAM,CAAC,IAAI,CAAC,OAAO,CAAC,eAAe,EAAE,IAAI,CAAC,eAAe,CAAC,CAAA;YAC/E,IAAI,CAAC,WAAW,GAAG,IAAI,CAAC,OAAO,CAAC,WAAW,GAAG,IAAI,CAAC,KAAK,CAAA;YAExD,MAAM,EAAE,GAAG,IAAI,CAAC,GAAG,CAAA;YACnB,MAAM,IAAI,GAAG,IAAI,CAAC,UAAU,CAAA;YAC5B,IAAI,EAAE,KAAK,SAAS,IAAI,IAAI,EAAE,CAAC;gBAC7B,IAAI,CAAC,aAAa,CAAC,EAAE,EAAE,IAAI,CAAC,WAAW,CAAC,CAAA;gBACxC,IAAI,CAAC,kBAAkB,CAAC,EAAE,EAAE,IAAI,CAAC,CAAA;YACnC,CAAC;QACH,CAAC;QAED,KAAK,MAAM,KAAK,IAAI,IAAI,CAAC,SAAS,EAAE,CAAC;YACnC,IACE,KAAK,CAAC,IAAI,KAAK,UAAU,CAAC,YAAY;gBACtC,KAAK,CAAC,IAAI,KAAK,UAAU,CAAC,aAAa,EACvC,CAAC;gBACD,KAAK,CAAC,oBAAoB,EAAE,CAAA;YAC9B,CAAC;QACH,CAAC;IACH,CAAC;IAED,IAAI,CAAC,CAAC,CAAC,IAAI,IAAI,CAAC,eAAe,CAAC,CAAC,GAAG,CAAC,CAAA,CAAC,CAAC;IACvC,IAAI,CAAC,KAAK,OAAO,IAAI,CAAC,eAAe,CAAC,CAAC,CAAA,CAAC,CAAC;IAEzC,IAAI,CAAC,CAAC,CAAC,IAAI,IAAI,CAAC,eAAe,CAAC,CAAC,GAAG,CAAC,CAAA,CAAC,CAAC;IACvC,IAAI,CAAC,KAAK,OAAO,IAAI,CAAC,eAAe,CAAC,CAAC,CAAA,CAAC,CAAC;CAC1C","sourcesContent":["import { ObjectStateTree, ObjectType } from '@hydraengine/shared'\nimport { LocalTransform } from '../local-transform'\nimport { WorldTransform } from '../world-transform'\n\nexport type GameObjectOptions = {\n  x?: number\n  y?: number\n}\n\nexport class GameObject {\n  type = ObjectType.GameObject\n\n  #id?: number\n  #stateTree?: ObjectStateTree\n\n  #parent?: GameObject\n  #children: GameObject[] = []\n\n  #localTransform = new LocalTransform()\n  #worldTransform = new WorldTransform()\n  alpha = 1\n  #worldAlpha = 1\n\n  protected _rootConfig(id: number, stateTree: ObjectStateTree) {\n    this.#id = id\n    this.#stateTree = stateTree\n    this.#worldTransform.x = 0\n    this.#worldTransform.y = 0\n  }\n\n  constructor(options?: GameObjectOptions) {\n    if (options) {\n      if (options.x !== undefined) this.x = options.x\n      if (options.y !== undefined) this.y = options.y\n    }\n  }\n\n  protected attachToStateTree(parentId: number, stateTree: ObjectStateTree) {\n    this.#detachFromStateTree()\n\n    const id = stateTree.newChild(parentId)\n    stateTree.setObjectType(id, this.type)\n    stateTree.setLocalAlpha(id, this.alpha)\n\n    this.#id = id\n    this.#stateTree = stateTree\n    this.#localTransform.setStateTree(id, stateTree)\n    this.#worldTransform.setStateTree(id, stateTree)\n\n    for (const child of this.#children) {\n      child.attachToStateTree(id, stateTree)\n    }\n\n    return id\n  }\n\n  #detachFromStateTree() {\n    if (this.#id !== undefined && this.#stateTree) this.#stateTree.remove(this.#id)\n    this.#id = undefined\n    this.#stateTree = undefined\n    this.#localTransform.clearStateTree()\n    this.#worldTransform.clearStateTree()\n  }\n\n  add(...children: GameObject[]) {\n    for (const child of children) {\n\n      if (child.#parent) {\n        const idx = child.#parent.#children.indexOf(child)\n        if (idx !== -1) child.#parent.#children.splice(idx, 1)\n      }\n\n      child.#parent = this\n      this.#children.push(child)\n\n      if (this.#id !== undefined && this.#stateTree) {\n        child.attachToStateTree(this.#id, this.#stateTree)\n      }\n    }\n  }\n\n  remove() {\n    this.#detachFromStateTree()\n\n    if (this.#parent) {\n      const idx = this.#parent.#children.indexOf(this)\n      if (idx !== -1) this.#parent.#children.splice(idx, 1)\n      this.#parent = undefined\n    }\n\n    for (const child of this.#children) {\n      child.#parent = undefined\n      child.remove()\n    }\n    this.#children.length = 0\n  }\n\n  update(dt: number) {\n    for (const child of this.#children) {\n      child.update(dt)\n    }\n  }\n\n  updateWorldTransform() {\n    if (this.#parent) {\n      this.#worldTransform.update(this.#parent.#worldTransform, this.#localTransform)\n      this.#worldAlpha = this.#parent.#worldAlpha * this.alpha\n\n      const id = this.#id\n      const tree = this.#stateTree\n      if (id !== undefined && tree) {\n        tree.setWorldAlpha(id, this.#worldAlpha)\n        tree.setWorldAlphaDirty(id, true)\n      }\n    }\n\n    for (const child of this.#children) {\n      if (\n        child.type !== ObjectType.PhysicsWorld &&\n        child.type !== ObjectType.PhysicsObject\n      ) {\n        child.updateWorldTransform()\n      }\n    }\n  }\n\n  set x(v) { this.#localTransform.x = v }\n  get x() { return this.#localTransform.x }\n\n  set y(v) { this.#localTransform.y = v }\n  get y() { return this.#localTransform.y }\n}\n"]}