{"version":3,"file":"spritesheet.js","sourceRoot":"","sources":["../../src/loaders/spritesheet.ts"],"names":[],"mappings":"AAAA,OAAO,EAAE,WAAW,EAAmB,MAAM,SAAS,CAAA;AACtD,OAAO,EAAE,MAAM,EAAE,MAAM,UAAU,CAAA;AACjC,OAAO,EAAE,aAAa,EAAE,MAAM,WAAW,CAAA;AAEzC,MAAM,iBAAkB,SAAQ,MAAmB;IAC9B,KAAK,CAAC,MAAM,CAAC,EAAU,EAAE,GAAW,EAAE,KAAsB;QAC7E,MAAM,cAAc,GAAG,CAAC,KAAK,IAAI,EAAE;YACjC,MAAM,OAAO,GAAG,MAAM,aAAa,CAAC,IAAI,CAAC,EAAE,EAAE,GAAG,CAAC,CAAA;YACjD,IAAI,CAAC,OAAO,EAAE,CAAC;gBACb,OAAO,CAAC,KAAK,CAAC,2BAA2B,GAAG,EAAE,CAAC,CAAA;gBAC/C,OAAM;YACR,CAAC;YAED,MAAM,WAAW,GAAG,IAAI,WAAW,CAAC,OAAO,EAAE,KAAK,CAAC,CAAA;YACnD,MAAM,WAAW,CAAC,KAAK,EAAE,CAAA;YAEzB,IAAI,CAAC,eAAe,CAAC,MAAM,CAAC,EAAE,CAAC,CAAA;YAE/B,IAAI,IAAI,CAAC,YAAY,CAAC,EAAE,CAAC,EAAE,CAAC;gBAC1B,IAAI,IAAI,CAAC,YAAY,CAAC,GAAG,CAAC,EAAE,CAAC,EAAE,CAAC;oBAC9B,aAAa,CAAC,OAAO,CAAC,EAAE,CAAC,CAAA;oBACzB,OAAO,CAAC,KAAK,CAAC,+BAA+B,GAAG,EAAE,CAAC,CAAA;gBACrD,CAAC;qBAAM,CAAC;oBACN,IAAI,CAAC,YAAY,CAAC,GAAG,CAAC,EAAE,EAAE,WAAW,CAAC,CAAA;oBACtC,OAAO,WAAW,CAAA;gBACpB,CAAC;YACH,CAAC;iBAAM,CAAC;gBACN,aAAa,CAAC,OAAO,CAAC,EAAE,CAAC,CAAA;YAC3B,CAAC;QACH,CAAC,CAAC,EAAE,CAAA;QAEJ,IAAI,CAAC,eAAe,CAAC,GAAG,CAAC,EAAE,EAAE,cAAc,CAAC,CAAA;QAC5C,OAAO,MAAM,cAAc,CAAA;IAC7B,CAAC;IAEkB,OAAO,CAAC,EAAU,EAAE,WAAwB;QAC7D,WAAW,CAAC,OAAO,EAAE,CAAA;QACrB,aAAa,CAAC,OAAO,CAAC,EAAE,CAAC,CAAA;IAC3B,CAAC;CACF;AAED,MAAM,CAAC,MAAM,iBAAiB,GAAG,IAAI,iBAAiB,EAAE,CAAA","sourcesContent":["import { Spritesheet, SpritesheetData } from 'pixi.js'\nimport { Loader } from './loader'\nimport { textureLoader } from './texture'\n\nclass SpritesheetLoader extends Loader<Spritesheet> {\n  protected override async doLoad(id: number, src: string, atlas: SpritesheetData) {\n    const loadingPromise = (async () => {\n      const texture = await textureLoader.load(id, src)\n      if (!texture) {\n        console.error(`Failed to load texture: ${src}`)\n        return\n      }\n\n      const spritesheet = new Spritesheet(texture, atlas)\n      await spritesheet.parse()\n\n      this.loadingPromises.delete(id)\n\n      if (this.hasActiveRef(id)) {\n        if (this.cachedAssets.has(id)) {\n          textureLoader.release(id)\n          console.error(`Spritesheet already exists: ${src}`)\n        } else {\n          this.cachedAssets.set(id, spritesheet)\n          return spritesheet\n        }\n      } else {\n        textureLoader.release(id)\n      }\n    })()\n\n    this.loadingPromises.set(id, loadingPromise)\n    return await loadingPromise\n  }\n\n  protected override cleanup(id: number, spritesheet: Spritesheet) {\n    spritesheet.destroy()\n    textureLoader.release(id)\n  }\n}\n\nexport const spritesheetLoader = new SpritesheetLoader()\n"]}