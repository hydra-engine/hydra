{"version":3,"file":"animated-sprite.js","sourceRoot":"","sources":["../../src/rendering-node/animated-sprite.ts"],"names":[],"mappings":"AACA,OAAO,EAAE,SAAS,EAAE,cAAc,IAAI,kBAAkB,EAAe,MAAM,SAAS,CAAA;AACtF,OAAO,EAAE,iBAAiB,EAAE,MAAM,wBAAwB,CAAA;AAC1D,OAAO,EAAE,cAAc,EAAE,MAAM,cAAc,CAAA;AAE7C,MAAM,OAAO,kBAAmB,SAAQ,cAAc;IACpD,QAAQ,CAAQ;IAChB,IAAI,CAAQ;IACZ,MAAM,CAAO;IACb,UAAU,CAAQ;IAElB,MAAM,CAAc;IACpB,OAAO,CAAqB;IAE5B,YAAY,OAAe,EAAE,GAAW,EAAE,KAAY,EAAE,SAAiB;QACvE,KAAK,CAAC,IAAI,SAAS,EAAE,CAAC,CAAA;QACtB,IAAI,CAAC,QAAQ,GAAG,OAAO,CAAA;QACvB,IAAI,CAAC,IAAI,GAAG,GAAG,CAAA;QACf,IAAI,CAAC,MAAM,GAAG,KAAK,CAAA;QACnB,IAAI,CAAC,UAAU,GAAG,SAAS,CAAA;QAC3B,IAAI,CAAC,KAAK,EAAE,CAAA;IACd,CAAC;IAED,KAAK,CAAC,KAAK;QACT,IAAI,iBAAiB,CAAC,WAAW,CAAC,IAAI,CAAC,QAAQ,CAAC,EAAE,CAAC;YACjD,IAAI,CAAC,MAAM,GAAG,iBAAiB,CAAC,SAAS,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAA;QAC1D,CAAC;aAAM,CAAC;YACN,OAAO,CAAC,IAAI,CAAC,2CAA2C,IAAI,CAAC,IAAI,EAAE,CAAC,CAAA;YACpE,IAAI,CAAC,MAAM,GAAG,MAAM,iBAAiB,CAAC,IAAI,CAAC,IAAI,CAAC,QAAQ,EAAE,IAAI,CAAC,IAAI,EAAE,IAAI,CAAC,MAAM,CAAC,CAAA;QACnF,CAAC;QAED,IAAI,CAAC,gBAAgB,EAAE,CAAA;IACzB,CAAC;IAED,gBAAgB;QACd,IAAI,CAAC,OAAO,EAAE,OAAO,EAAE,CAAA;QACvB,IAAI,CAAC,OAAO,GAAG,SAAS,CAAA;QAExB,IAAI,IAAI,CAAC,MAAM,EAAE,CAAC;YAChB,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC,UAAU,CAAC,IAAI,CAAC,UAAU,CAAC,EAAE,CAAC;gBAC7C,OAAO,CAAC,KAAK,CAAC,wBAAwB,IAAI,CAAC,UAAU,EAAE,CAAC,CAAA;gBACxD,OAAM;YACR,CAAC;YAED,MAAM,CAAC,GAAG,IAAI,kBAAkB,CAAC,IAAI,CAAC,MAAM,CAAC,UAAU,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC,CAAA;YACzE,CAAC,CAAC,MAAM,CAAC,GAAG,CAAC,GAAG,EAAE,GAAG,CAAC,CAAA;YAEtB,MAAM,CAAC,GAAG,IAAI,CAAC,MAAM,CAAC,UAAU,CAAC,IAAI,CAAC,UAAU,CAAC,CAAA;YACjD,CAAC,CAAC,IAAI,GAAG,CAAC,CAAC,IAAI,CAAA;YACf,CAAC,CAAC,cAAc,GAAG,CAAC,CAAC,GAAG,GAAG,EAAE,CAAA;YAC7B,CAAC,CAAC,IAAI,EAAE,CAAA;YAER,IAAI,CAAC,aAAa,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAA;YAC9B,IAAI,CAAC,OAAO,GAAG,CAAC,CAAA;QAClB,CAAC;IACH,CAAC;IAEQ,MAAM;QACb,iBAAiB,CAAC,OAAO,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAA;QACxC,KAAK,CAAC,MAAM,EAAE,CAAA;IAChB,CAAC;CACF","sourcesContent":["import { Atlas } from '@hydraengine/shared'\nimport { Container, AnimatedSprite as PixiAnimatedSprite, Spritesheet } from 'pixi.js'\nimport { spritesheetLoader } from '../loaders/spritesheet'\nimport { RenderableNode } from './renderable'\n\nexport class AnimatedSpriteNode extends RenderableNode {\n  #assetId: number\n  #src: string\n  #atlas: Atlas\n  #animation: string\n\n  #sheet?: Spritesheet\n  #sprite?: PixiAnimatedSprite\n\n  constructor(assetId: number, src: string, atlas: Atlas, animation: string) {\n    super(new Container())\n    this.#assetId = assetId\n    this.#src = src\n    this.#atlas = atlas\n    this.#animation = animation\n    this.#load()\n  }\n\n  async #load() {\n    if (spritesheetLoader.checkCached(this.#assetId)) {\n      this.#sheet = spritesheetLoader.getCached(this.#assetId)\n    } else {\n      console.info(`Spritesheet not preloaded. Loading now: ${this.#src}`)\n      this.#sheet = await spritesheetLoader.load(this.#assetId, this.#src, this.#atlas)\n    }\n\n    this.#updateAnimation()\n  }\n\n  #updateAnimation() {\n    this.#sprite?.destroy()\n    this.#sprite = undefined\n\n    if (this.#sheet) {\n      if (!this.#sheet.animations[this.#animation]) {\n        console.error(`Animation not found: ${this.#animation}`)\n        return\n      }\n\n      const s = new PixiAnimatedSprite(this.#sheet.animations[this.#animation])\n      s.anchor.set(0.5, 0.5)\n\n      const a = this.#atlas.animations[this.#animation]\n      s.loop = a.loop\n      s.animationSpeed = a.fps / 60\n      s.play()\n\n      this.pixiContainer.addChild(s)\n      this.#sprite = s\n    }\n  }\n\n  override remove() {\n    spritesheetLoader.release(this.#assetId)\n    super.remove()\n  }\n}\n"]}