(()=>{"use strict";let t=!1;class e{#t;#e;constructor(t,e,s,i){this.#e=s;const o=s*i,r=Math.ceil(o/32);this.#t=new Uint32Array(t,e,r)}static bytesRequired(t,e){const s=t*e;return Math.ceil(s/32)*Uint32Array.BYTES_PER_ELEMENT}get byteLength(){return this.#t.byteLength}#s(t,e){return t*this.#e+e}set(t,e,s){const i=this.#s(t,e),o=i>>>5,r=1<<(31&i);s?this.#t[o]|=r:this.#t[o]&=~r}get(t,e){const s=this.#s(t,e),i=s>>>5,o=1<<(31&s);return 0!==(this.#t[i]&o)}}class s{#i;#e;constructor(t,e,s,i){this.#e=s,this.#i=new Float32Array(t,e,s*i)}static bytesRequired(t,e){return t*e*Float32Array.BYTES_PER_ELEMENT}get byteLength(){return this.#i.byteLength}#o(t){return t*this.#e}set(t,e,s){this.#i[this.#o(t)+e]=s}get(t,e){return this.#i[this.#o(t)+e]}}class i{#i;#e;constructor(t,e,s,i){this.#e=s,this.#i=new Uint32Array(t,e,s*i)}static bytesRequired(t,e){return t*e*Uint32Array.BYTES_PER_ELEMENT}get byteLength(){return this.#i.byteLength}#o(t){return t*this.#e}set(t,e,s){this.#i[this.#o(t)+e]=s}get(t,e){return this.#i[this.#o(t)+e]}}const o=4294967295;class r{#r;constructor(t,e,s){this.#r=new Uint32Array(t,e,5*s)}static bytesRequired(t){return 5*t*Uint32Array.BYTES_PER_ELEMENT}get byteLength(){return this.#r.byteLength}#o(t){return 5*t}parent(t){return this.#r[this.#o(t)+0]}#a(t){return this.#r[this.#o(t)+1]}#n(t){return this.#r[this.#o(t)+2]}#h(t){return this.#r[this.#o(t)+4]}remove(t){const e=this.#o(t),s=this.#r[e+0],i=this.#r[e+3],r=this.#r[e+4];if(s!==o){const e=this.#o(s);this.#r[e+1]===t&&(this.#r[e+1]=r),this.#r[e+2]===t&&(this.#r[e+2]=i)}i!==o&&(this.#r[this.#o(i)+4]=r),r!==o&&(this.#r[this.#o(r)+3]=i)}#l(t,e){const s=this.#o(t),i=this.#o(e);this.#r[i+0]=t,this.#r[i+3]=o,this.#r[i+4]=o,this.#r[s+1]=e,this.#r[s+2]=e}#c(t,e,s){const i=this.#o(e),r=this.#r[i+4],a=this.#o(s);this.#r[a+0]=t,this.#r[a+3]=e,this.#r[a+4]=r,this.#r[i+4]=s,r!==o?this.#r[this.#o(r)+3]=s:this.#r[this.#o(t)+2]=s}#d(t,e,s){const i=this.#o(e),r=this.#r[i+3],a=this.#o(s);this.#r[a+0]=t,this.#r[a+4]=e,this.#r[a+3]=r,this.#r[i+3]=s,r!==o?this.#r[this.#o(r)+4]=s:this.#r[this.#o(t)+1]=s}insert(t,e){this.remove(e);const s=this.#n(t);s===o?this.#l(t,e):this.#c(t,s,e)}insertAt(t,e,s){this.remove(e);const i=this.#a(t);if(i===o)return void this.#l(t,e);if(s<=0)return void this.#d(t,i,e);let r=0,a=i;for(;a!==o&&r<s;)a=this.#h(a),r++;a===o?this.insert(t,e):this.#d(t,a,e)}forEach(t){let e=0;for(;;){t(e);const s=this.#a(e);if(s===o)for(;;){if(0===e)return;const t=this.#h(e);if(t!==o){e=t;break}e=this.parent(e)}else e=s}}sortChildren(t,e){let s=0,i=this.#a(t);for(;i!==o;)s++,i=this.#h(i);if(s<=1)return;let r=1;for(;r<s;){let s=o,i=o,a=this.#a(t);for(;a!==o;){let n=a,h=1;for(;h<r&&this.#h(a)!==o;)a=this.#h(a),h++;let l=this.#h(a);const c=l;this.#r[this.#o(a)+4]=o,l!==o&&(this.#r[this.#o(l)+3]=o);let d=c;for(h=0;h<r&&d!==o;)d=this.#h(d),h++;if(d!==o){const t=this.#r[this.#o(d)+3];t!==o&&(this.#r[this.#o(t)+4]=o),this.#r[this.#o(d)+3]=o}a=d;let u=o,g=o,m=n,y=l;for(;m!==o||y!==o;){let s=!1;s=y===o||m!==o&&e(m)<=e(y);const i=s?m:y;s?m=this.#h(m):y=this.#h(y);const r=this.#o(i);this.#r[r+3]=g,this.#r[r+4]=o,this.#r[r+0]=t,u===o?u=i:this.#r[this.#o(g)+4]=i,g=i}s===o?s=u:(this.#r[this.#o(i)+4]=u,this.#r[this.#o(u)+3]=i),i=g}const n=this.#o(t);this.#r[n+1]=s,this.#r[n+2]=i,r<<=1}}}class a{#u;#i;#g;constructor(t,e,s){this.#u=new Uint32Array(t,e,2),this.#i=new Uint32Array(t,e+2*Uint32Array.BYTES_PER_ELEMENT,s),this.#g=s}static bytesRequired(t){return(2+t)*Uint32Array.BYTES_PER_ELEMENT}get byteLength(){return this.#u.byteLength+this.#i.byteLength}enqueue(t){const e=this.#u[1];this.#i[e]=t,this.#u[1]=(e+1)%this.#g}dequeue(){const t=this.#u[0];return this.#u[0]=(t+1)%this.#g,this.#i[t]}}class n{#m;constructor(t,e,s){this.#m=new a(t,e,s-1)}static bytesRequired(t){return a.bytesRequired(t-1)}get byteLength(){return this.#m.byteLength}alloc(){return this.#m.dequeue()}free(t){this.#m.enqueue(t)}}class h{#y;#L;#b;#f;#F;constructor(t,o,a,h,l){this.#y=new n(t,0,l);let c=this.#y.byteLength;this.#L=new r(t,c,l),c+=this.#L.byteLength,this.#b=new e(t,c,o,l),c+=this.#b.byteLength,this.#f=new i(t,c,a,l),c+=this.#f.byteLength,this.#F=new s(t,c,h,l)}static bytesRequired(t,o,a,h){return n.bytesRequired(h)+r.bytesRequired(h)+e.bytesRequired(t,h)+i.bytesRequired(o,h)+s.bytesRequired(a,h)}newChild(t){const e=this.#y.alloc();return this.#L.insert(t,e),e}getParent(t){return this.#L.parent(t)}insertAt(t,e,s){this.#L.insertAt(t,e,s)}remove(t){this.#L.remove(t),this.#y.free(t)}setBoolean(t,e,s){this.#b.set(t,e,s)}getBoolean(t,e){return this.#b.get(t,e)}setUint32(t,e,s){this.#f.set(t,e,s)}getUint32(t,e){return this.#f.get(t,e)}setFloat32(t,e,s){this.#F.set(t,e,s)}getFloat32(t,e){return this.#F.get(t,e)}forEach(t){this.#L.forEach(t)}sortChildren(t,e){this.#L.sortChildren(t,t=>this.#f.get(t,e))}}const l=1e6;class c extends h{constructor(t){super(t,0,4,18,l)}static bytesRequired(){return h.bytesRequired(0,4,18,l)}setObjectType(t,e){this.setUint32(t,0,e)}getObjectType(t){return this.getUint32(t,0)}setLocalX(t,e){this.setFloat32(t,0,e)}getLocalX(t){return this.getFloat32(t,0)}setLocalY(t,e){this.setFloat32(t,1,e)}getLocalY(t){return this.getFloat32(t,1)}setLocalScaleX(t,e){this.setFloat32(t,2,e)}getLocalScaleX(t){return this.getFloat32(t,2)}setLocalScaleY(t,e){this.setFloat32(t,3,e)}getLocalScaleY(t){return this.getFloat32(t,3)}setLocalPivotX(t,e){this.setFloat32(t,4,e)}getLocalPivotX(t){return this.getFloat32(t,4)}setLocalPivotY(t,e){this.setFloat32(t,5,e)}getLocalPivotY(t){return this.getFloat32(t,5)}setLocalRotation(t,e){this.setFloat32(t,6,e)}getLocalRotation(t){return this.getFloat32(t,6)}setLocalCos(t,e){this.setFloat32(t,7,e)}getLocalCos(t){return this.getFloat32(t,7)}setLocalSin(t,e){this.setFloat32(t,8,e)}getLocalSin(t){return this.getFloat32(t,8)}setLocalAlpha(t,e){this.setFloat32(t,9,e)}getLocalAlpha(t){return this.getFloat32(t,9)}setWorldX(t,e){this.setFloat32(t,10,e)}getWorldX(t){return this.getFloat32(t,10)}setWorldY(t,e){this.setFloat32(t,11,e)}getWorldY(t){return this.getFloat32(t,11)}setWorldScaleX(t,e){this.setFloat32(t,12,e)}getWorldScaleX(t){return this.getFloat32(t,12)}setWorldScaleY(t,e){this.setFloat32(t,13,e)}getWorldScaleY(t){return this.getFloat32(t,13)}setWorldRotation(t,e){this.setFloat32(t,14,e)}getWorldRotation(t){return this.getFloat32(t,14)}setWorldCos(t,e){this.setFloat32(t,15,e)}getWorldCos(t){return this.getFloat32(t,15)}setWorldSin(t,e){this.setFloat32(t,16,e)}getWorldSin(t){return this.getFloat32(t,16)}setWorldAlpha(t,e){this.setFloat32(t,17,e)}getWorldAlpha(t){return this.getFloat32(t,17)}setLayer(t,e){this.setUint32(t,1,e)}getLayer(t){return this.getUint32(t,1)}setAssetId(t,e){this.setUint32(t,2,e)}getAssetId(t){return this.getUint32(t,2)}setAnimationId(t,e){this.setUint32(t,3,e)}getAnimationId(t){return this.getUint32(t,3)}setWorldId(t,e){this.setUint32(t,2,e)}getWorldId(t){return this.getUint32(t,2)}setBodyId(t,e){this.setUint32(t,2,e)}getBodyId(t){return this.getUint32(t,2)}}var d;!function(t){t[t.GameObject=0]="GameObject",t[t.Sprite=1]="Sprite",t[t.AnimatedSprite=2]="AnimatedSprite",t[t.PhysicsWorld=3]="PhysicsWorld",t[t.PhysicsObject=4]="PhysicsObject"}(d||(d={}));class u{#p;#P=0;constructor(t,e){this.#p=void 0!==e&&e>0?e:void 0;let s=performance.now(),i=0;const o=e=>{const r=(e-s)/1e3;if(r>0){const o=this.#p;if(void 0!==o&&o>0){i+=r;const e=1/o;i>=e&&(t(e),i>=2*e?(t(r),i=0):i-=e)}else t(r);s=e}this.#P=requestAnimationFrame(o)};this.#P=requestAnimationFrame(o)}setFpsCap(t){this.#p=t>0?t:void 0}disableFpsCap(){this.#p=void 0}remove(){cancelAnimationFrame(this.#P)}}let g;t=!0;let m=0;onmessage=async({data:t})=>{const e=t.type;var s;"init"===e&&(s=new c(t.sab),g=new u(t=>{var e;m=1/t,(e=s).forEach(t=>{const s=e.getParent(t);if(s===o)return;const i=e.getWorldCos(s),r=e.getWorldSin(s),a=e.getWorldX(s),n=e.getWorldY(s),h=e.getLocalX(t)*e.getWorldScaleX(s),l=e.getLocalY(t)*e.getWorldScaleY(s),c=e.getWorldScaleX(s)*e.getLocalScaleX(t),d=e.getWorldScaleY(s)*e.getLocalScaleY(t);e.setWorldScaleX(t,c),e.setWorldScaleY(t,d);const u=e.getLocalCos(t),g=e.getLocalSin(t),m=i*u-r*g,y=r*u+i*g,L=e.getWorldRotation(s)+e.getLocalRotation(t);e.setWorldRotation(t,L),e.setWorldCos(t,m),e.setWorldSin(t,y);const b=e.getLocalPivotX(t)*c,f=e.getLocalPivotY(t)*d,F=a+(h*i-l*r)-(b*m-f*y),p=n+(h*r+l*i)-(b*y+f*m);e.setWorldX(t,F),e.setWorldY(t,p),e.setWorldAlpha(t,e.getWorldAlpha(s)*e.getLocalAlpha(t))})}),setInterval(()=>{postMessage({type:"fps",value:m})},1e3)),"setFpsCap"===e&&g.setFpsCap(t.fps)}})();