(()=>{"use strict";let t=!1;class e{#t;#e;constructor(t,e,s,i){this.#e=s;const o=s*i,r=Math.ceil(o/32);this.#t=new Uint32Array(t,e,r)}static bytesRequired(t,e){const s=t*e;return Math.ceil(s/32)*Uint32Array.BYTES_PER_ELEMENT}get byteLength(){return this.#t.byteLength}#s(t,e){return t*this.#e+e}set(t,e,s){const i=this.#s(t,e),o=i>>>5,r=1<<(31&i);s?this.#t[o]|=r:this.#t[o]&=~r}get(t,e){const s=this.#s(t,e),i=s>>>5,o=1<<(31&s);return 0!==(this.#t[i]&o)}}class s{#i;#e;constructor(t,e,s,i){this.#e=s,this.#i=new Float32Array(t,e,s*i)}static bytesRequired(t,e){return t*e*Float32Array.BYTES_PER_ELEMENT}get byteLength(){return this.#i.byteLength}#o(t){return t*this.#e}set(t,e,s){this.#i[this.#o(t)+e]=s}get(t,e){return this.#i[this.#o(t)+e]}}class i{#i;#e;constructor(t,e,s,i){this.#e=s,this.#i=new Uint32Array(t,e,s*i)}static bytesRequired(t,e){return t*e*Uint32Array.BYTES_PER_ELEMENT}get byteLength(){return this.#i.byteLength}#o(t){return t*this.#e}set(t,e,s){this.#i[this.#o(t)+e]=s}get(t,e){return this.#i[this.#o(t)+e]}}const o=4294967295;class r{#r;constructor(t,e,s){this.#r=new Uint32Array(t,e,5*s)}static bytesRequired(t){return 5*t*Uint32Array.BYTES_PER_ELEMENT}get byteLength(){return this.#r.byteLength}#o(t){return 5*t}parent(t){return this.#r[this.#o(t)+0]}#a(t){return this.#r[this.#o(t)+1]}#h(t){return this.#r[this.#o(t)+2]}#n(t){return this.#r[this.#o(t)+4]}remove(t){const e=this.#o(t),s=this.#r[e+0],i=this.#r[e+3],r=this.#r[e+4];if(s!==o){const e=this.#o(s);this.#r[e+1]===t&&(this.#r[e+1]=r),this.#r[e+2]===t&&(this.#r[e+2]=i)}i!==o&&(this.#r[this.#o(i)+4]=r),r!==o&&(this.#r[this.#o(r)+3]=i)}#l(t,e){const s=this.#o(t),i=this.#o(e);this.#r[i+0]=t,this.#r[i+3]=o,this.#r[i+4]=o,this.#r[s+1]=e,this.#r[s+2]=e}#c(t,e,s){const i=this.#o(e),r=this.#r[i+4],a=this.#o(s);this.#r[a+0]=t,this.#r[a+3]=e,this.#r[a+4]=r,this.#r[i+4]=s,r!==o?this.#r[this.#o(r)+3]=s:this.#r[this.#o(t)+2]=s}#d(t,e,s){const i=this.#o(e),r=this.#r[i+3],a=this.#o(s);this.#r[a+0]=t,this.#r[a+4]=e,this.#r[a+3]=r,this.#r[i+3]=s,r!==o?this.#r[this.#o(r)+4]=s:this.#r[this.#o(t)+1]=s}insert(t,e){this.remove(e);const s=this.#h(t);s===o?this.#l(t,e):this.#c(t,s,e)}insertAt(t,e,s){this.remove(e);const i=this.#a(t);if(i===o)return void this.#l(t,e);if(s<=0)return void this.#d(t,i,e);let r=0,a=i;for(;a!==o&&r<s;)a=this.#n(a),r++;a===o?this.insert(t,e):this.#d(t,a,e)}forEach(t){let e=0;for(;;){t(e);const s=this.#a(e);if(s===o)for(;;){if(0===e)return;const t=this.#n(e);if(t!==o){e=t;break}e=this.parent(e)}else e=s}}sortChildren(t,e){let s=0,i=this.#a(t);for(;i!==o;)s++,i=this.#n(i);if(s<=1)return;let r=1;for(;r<s;){let s=o,i=o,a=this.#a(t);for(;a!==o;){let h=a,n=1;for(;n<r&&this.#n(a)!==o;)a=this.#n(a),n++;let l=this.#n(a);const c=l;this.#r[this.#o(a)+4]=o,l!==o&&(this.#r[this.#o(l)+3]=o);let d=c;for(n=0;n<r&&d!==o;)d=this.#n(d),n++;if(d!==o){const t=this.#r[this.#o(d)+3];t!==o&&(this.#r[this.#o(t)+4]=o),this.#r[this.#o(d)+3]=o}a=d;let u=o,g=o,m=h,y=l;for(;m!==o||y!==o;){let s=!1;s=y===o||m!==o&&e(m)<=e(y);const i=s?m:y;s?m=this.#n(m):y=this.#n(y);const r=this.#o(i);this.#r[r+3]=g,this.#r[r+4]=o,this.#r[r+0]=t,u===o?u=i:this.#r[this.#o(g)+4]=i,g=i}s===o?s=u:(this.#r[this.#o(i)+4]=u,this.#r[this.#o(u)+3]=i),i=g}const h=this.#o(t);this.#r[h+1]=s,this.#r[h+2]=i,r<<=1}}}class a{#u;#i;#g;constructor(t,e,s){this.#u=new Uint32Array(t,e,2),this.#i=new Uint32Array(t,e+2*Uint32Array.BYTES_PER_ELEMENT,s),this.#g=s}static bytesRequired(t){return(2+t)*Uint32Array.BYTES_PER_ELEMENT}get byteLength(){return this.#u.byteLength+this.#i.byteLength}enqueue(t){const e=this.#u[1];this.#i[e]=t,this.#u[1]=(e+1)%this.#g}dequeue(){const t=this.#u[0];return this.#u[0]=(t+1)%this.#g,this.#i[t]}}class h{#m;constructor(t,e,s){this.#m=new a(t,e,s-1)}static bytesRequired(t){return a.bytesRequired(t-1)}get byteLength(){return this.#m.byteLength}alloc(){return this.#m.dequeue()}free(t){this.#m.enqueue(t)}}class n{#y;#p;#f;#v;#L;constructor(t,o,a,n,l){this.#y=new h(t,0,l);let c=this.#y.byteLength;this.#p=new r(t,c,l),c+=this.#p.byteLength,this.#f=new e(t,c,o,l),c+=this.#f.byteLength,this.#v=new i(t,c,a,l),c+=this.#v.byteLength,this.#L=new s(t,c,n,l)}static bytesRequired(t,o,a,n){return h.bytesRequired(n)+r.bytesRequired(n)+e.bytesRequired(t,n)+i.bytesRequired(o,n)+s.bytesRequired(a,n)}newChild(t){const e=this.#y.alloc();return this.#p.insert(t,e),e}getParent(t){return this.#p.parent(t)}insertAt(t,e,s){this.#p.insertAt(t,e,s)}remove(t){this.#p.remove(t),this.#y.free(t)}setBoolean(t,e,s){this.#f.set(t,e,s)}getBoolean(t,e){return this.#f.get(t,e)}setUint32(t,e,s){this.#v.set(t,e,s)}getUint32(t,e){return this.#v.get(t,e)}setFloat32(t,e,s){this.#L.set(t,e,s)}getFloat32(t,e){return this.#L.get(t,e)}forEach(t){this.#p.forEach(t)}sortChildren(t,e){this.#p.sortChildren(t,t=>this.#v.get(t,e))}}const l=1e6;class c extends n{constructor(t){super(t,0,4,18,l)}static bytesRequired(){return n.bytesRequired(0,4,18,l)}setObjectType(t,e){this.setUint32(t,0,e)}getObjectType(t){return this.getUint32(t,0)}setLocalX(t,e){this.setFloat32(t,0,e)}getLocalX(t){return this.getFloat32(t,0)}setLocalY(t,e){this.setFloat32(t,1,e)}getLocalY(t){return this.getFloat32(t,1)}setLocalScaleX(t,e){this.setFloat32(t,2,e)}getLocalScaleX(t){return this.getFloat32(t,2)}setLocalScaleY(t,e){this.setFloat32(t,3,e)}getLocalScaleY(t){return this.getFloat32(t,3)}setLocalPivotX(t,e){this.setFloat32(t,4,e)}getLocalPivotX(t){return this.getFloat32(t,4)}setLocalPivotY(t,e){this.setFloat32(t,5,e)}getLocalPivotY(t){return this.getFloat32(t,5)}setLocalRotation(t,e){this.setFloat32(t,6,e)}getLocalRotation(t){return this.getFloat32(t,6)}setLocalCos(t,e){this.setFloat32(t,7,e)}getLocalCos(t){return this.getFloat32(t,7)}setLocalSin(t,e){this.setFloat32(t,8,e)}getLocalSin(t){return this.getFloat32(t,8)}setLocalAlpha(t,e){this.setFloat32(t,9,e)}getLocalAlpha(t){return this.getFloat32(t,9)}setWorldX(t,e){this.setFloat32(t,10,e)}getWorldX(t){return this.getFloat32(t,10)}setWorldY(t,e){this.setFloat32(t,11,e)}getWorldY(t){return this.getFloat32(t,11)}setWorldScaleX(t,e){this.setFloat32(t,12,e)}getWorldScaleX(t){return this.getFloat32(t,12)}setWorldScaleY(t,e){this.setFloat32(t,13,e)}getWorldScaleY(t){return this.getFloat32(t,13)}setWorldRotation(t,e){this.setFloat32(t,14,e)}getWorldRotation(t){return this.getFloat32(t,14)}setWorldCos(t,e){this.setFloat32(t,15,e)}getWorldCos(t){return this.getFloat32(t,15)}setWorldSin(t,e){this.setFloat32(t,16,e)}getWorldSin(t){return this.getFloat32(t,16)}setWorldAlpha(t,e){this.setFloat32(t,17,e)}getWorldAlpha(t){return this.getFloat32(t,17)}setLayer(t,e){this.setUint32(t,1,e)}getLayer(t){return this.getUint32(t,1)}setAssetId(t,e){this.setUint32(t,2,e)}getAssetId(t){return this.getUint32(t,2)}setAnimationId(t,e){this.setUint32(t,3,e)}getAnimationId(t){return this.getUint32(t,3)}setWorldId(t,e){this.setUint32(t,2,e)}getWorldId(t){return this.getUint32(t,2)}setBodyId(t,e){this.setUint32(t,2,e)}getBodyId(t){return this.getUint32(t,2)}}var d,u,g,m;(g=d||(d={}))[g.GameObject=0]="GameObject",g[g.Sprite=1]="Sprite",g[g.AnimatedSprite=2]="AnimatedSprite",g[g.PhysicsWorld=3]="PhysicsWorld",g[g.PhysicsObject=4]="PhysicsObject";class y{#T;#F=0;constructor(t,e){this.#T=void 0!==e&&e>0?e:void 0;let s=performance.now(),i=0;const o=e=>{const r=(e-s)/1e3;if(r>0){const o=this.#T;if(void 0!==o&&o>0){i+=r;const e=1/o;i>=e&&(t(e),i>=2*e?(t(r),i=0):i-=e)}else t(r);s=e}this.#F=requestAnimationFrame(o)};this.#F=requestAnimationFrame(o)}setFpsCap(t){this.#T=t>0?t:void 0}disableFpsCap(){this.#T=void 0}remove(){cancelAnimationFrame(this.#F)}}class p{#b;#S;#A=0;#P=0;#Y=1;#C=1;#E=0;#x=0;#X=0;cos=1;sin=0;get x(){return this.#A}set x(t){if(this.#A!==t){this.#A=t;const e=this.#b,s=this.#S;s&&void 0!==e&&s.setLocalX(e,t)}}get y(){return this.#P}set y(t){if(this.#P!==t){this.#P=t;const e=this.#b,s=this.#S;s&&void 0!==e&&s.setLocalY(e,t)}}get scaleX(){return this.#Y}set scaleX(t){if(this.#Y!==t){this.#Y=t;const e=this.#b,s=this.#S;s&&void 0!==e&&s.setLocalScaleX(e,t)}}get scaleY(){return this.#C}set scaleY(t){if(this.#C!==t){this.#C=t;const e=this.#b,s=this.#S;s&&void 0!==e&&s.setLocalScaleY(e,t)}}get pivotX(){return this.#E}set pivotX(t){if(this.#E!==t){this.#E=t;const e=this.#b,s=this.#S;s&&void 0!==e&&s.setLocalPivotX(e,t)}}get pivotY(){return this.#x}set pivotY(t){if(this.#x!==t){this.#x=t;const e=this.#b,s=this.#S;s&&void 0!==e&&s.setLocalPivotY(e,t)}}get rotation(){return this.#X}set rotation(t){if(this.#X!==t){this.#X=t;const e=Math.cos(t),s=Math.sin(t);this.cos=e,this.sin=s;const i=this.#b,o=this.#S;o&&void 0!==i&&(o.setLocalRotation(i,t),o.setLocalCos(i,e),o.setLocalSin(i,s))}}setStateTree(t,e){this.#b=t,this.#S=e,e.setLocalX(t,this.#A),e.setLocalY(t,this.#P),e.setLocalScaleX(t,this.#Y),e.setLocalScaleY(t,this.#C),e.setLocalPivotX(t,this.#E),e.setLocalPivotY(t,this.#x),e.setLocalRotation(t,this.#X),e.setLocalCos(t,this.cos),e.setLocalSin(t,this.sin)}clearStateTree(){this.#b=void 0,this.#S=void 0}}class f{type=d.GameObject;#b;#S;#I;#w=[];#R=new p;alpha=1;#q=0;_rootConfig(t,e){this.#b=t,this.#S=e,e.setWorldScaleX(t,1),e.setWorldScaleY(t,1),e.setWorldCos(t,1),e.setWorldAlpha(t,1)}constructor(t){t&&(void 0!==t.x&&(this.x=t.x),void 0!==t.y&&(this.y=t.y),void 0!==t.layer&&(this.layer=t.layer))}attachToStateTree(t,e){this.#U();const s=e.newChild(t);e.setObjectType(s,this.type),e.setLocalAlpha(s,this.alpha),this.#b=s,this.#S=e,this.#R.setStateTree(s,e),e.setLayer(s,this.#q);for(const t of this.#w)t.attachToStateTree(s,e);return s}#U(){void 0!==this.#b&&this.#S&&this.#S.remove(this.#b),this.#b=void 0,this.#S=void 0,this.#R.clearStateTree()}add(...t){for(const e of t){if(e.#I){const t=e.#I.#w.indexOf(e);-1!==t&&e.#I.#w.splice(t,1)}e.#I=this,this.#w.push(e),void 0!==this.#b&&this.#S&&e.attachToStateTree(this.#b,this.#S)}}remove(){if(this.#U(),this.#I){const t=this.#I.#w.indexOf(this);-1!==t&&this.#I.#w.splice(t,1),this.#I=void 0}for(const t of this.#w)t.#I=void 0,t.remove();this.#w.length=0}update(t){for(const e of this.#w)e.update(t)}set x(t){this.#R.x=t}get x(){return this.#R.x}set y(t){this.#R.y=t}get y(){return this.#R.y}set layer(t){this.#q!==t&&(this.#q=t,void 0!==this.#b&&this.#S&&this.#S.setLayer(this.#b,t))}get layer(){return this.#q}}class v extends f{constructor(t){super(),this._rootConfig(0,t)}}class L extends f{type=d.AnimatedSprite;#W;#B;constructor(t){super(t),this.#W=t.asset,this.#B=t.animation}attachToStateTree(t,e){const s=super.attachToStateTree(t,e);return e.setAssetId(s,this.#W),e.setAnimationId(s,this.#B),s}}class T extends f{type=d.Sprite;#W;constructor(t){super(t),this.#W=t.asset}attachToStateTree(t,e){const s=super.attachToStateTree(t,e);return e.setAssetId(s,this.#W),s}}let F,b;!function(t){t[t.Fire=0]="Fire"}(u||(u={})),u.Fire,function(t){t[t.Bird=0]="Bird",t[t.Fire=1]="Fire"}(m||(m={})),m.Bird,m.Fire,t=!0;let S=0;onmessage=t=>{const e=t.data.type;"init"===e&&function(t){b=new v(t);for(let t=0;t<100;t++){const t=new T({asset:m.Bird,x:800*Math.random()-400,y:600*Math.random()-300});b.add(t)}const e=new L({asset:m.Fire,animation:u.Fire});b.add(e),F=new y(t=>{S=1/t,b.update(t)}),setInterval(()=>{postMessage({type:"fps",value:S})},1e3)}(new c(t.data.sab)),"setFpsCap"===e&&F.setFpsCap(t.data.fps)}})();