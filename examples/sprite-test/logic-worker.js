(()=>{"use strict";let t=!1;class e{#t;#e;constructor(t,e,s,i){this.#e=s;const r=s*i,o=Math.ceil(r/32);this.#t=new Uint32Array(t,e,o)}static bytesRequired(t,e){const s=t*e;return Math.ceil(s/32)*Uint32Array.BYTES_PER_ELEMENT}get byteLength(){return this.#t.byteLength}#s(t,e){return t*this.#e+e}set(t,e,s){const i=this.#s(t,e),r=i>>>5,o=1<<(31&i);s?this.#t[r]|=o:this.#t[r]&=~o}get(t,e){const s=this.#s(t,e),i=s>>>5,r=1<<(31&s);return 0!==(this.#t[i]&r)}}class s{#i;#e;constructor(t,e,s,i){this.#e=s,this.#i=new Float32Array(t,e,s*i)}static bytesRequired(t,e){return t*e*Float32Array.BYTES_PER_ELEMENT}get byteLength(){return this.#i.byteLength}#r(t){return t*this.#e}set(t,e,s){this.#i[this.#r(t)+e]=s}get(t,e){return this.#i[this.#r(t)+e]}}class i{#i;#e;constructor(t,e,s,i){this.#e=s,this.#i=new Uint32Array(t,e,s*i)}static bytesRequired(t,e){return t*e*Uint32Array.BYTES_PER_ELEMENT}get byteLength(){return this.#i.byteLength}#r(t){return t*this.#e}set(t,e,s){this.#i[this.#r(t)+e]=s}get(t,e){return this.#i[this.#r(t)+e]}}const r=4294967295;class o{#o;constructor(t,e,s){this.#o=new Uint32Array(t,e,5*s)}static bytesRequired(t){return 5*t*Uint32Array.BYTES_PER_ELEMENT}get byteLength(){return this.#o.byteLength}#r(t){return 5*t}parent(t){return this.#o[this.#r(t)+0]}#a(t){return this.#o[this.#r(t)+1]}#n(t){return this.#o[this.#r(t)+2]}#h(t){return this.#o[this.#r(t)+4]}remove(t){const e=this.#r(t),s=this.#o[e+0],i=this.#o[e+3],o=this.#o[e+4];if(s!==r){const e=this.#r(s);this.#o[e+1]===t&&(this.#o[e+1]=o),this.#o[e+2]===t&&(this.#o[e+2]=i)}i!==r&&(this.#o[this.#r(i)+4]=o),o!==r&&(this.#o[this.#r(o)+3]=i)}#l(t,e){const s=this.#r(t),i=this.#r(e);this.#o[i+0]=t,this.#o[i+3]=r,this.#o[i+4]=r,this.#o[s+1]=e,this.#o[s+2]=e}#c(t,e,s){const i=this.#r(e),o=this.#o[i+4],a=this.#r(s);this.#o[a+0]=t,this.#o[a+3]=e,this.#o[a+4]=o,this.#o[i+4]=s,o!==r?this.#o[this.#r(o)+3]=s:this.#o[this.#r(t)+2]=s}#d(t,e,s){const i=this.#r(e),o=this.#o[i+3],a=this.#r(s);this.#o[a+0]=t,this.#o[a+4]=e,this.#o[a+3]=o,this.#o[i+3]=s,o!==r?this.#o[this.#r(o)+4]=s:this.#o[this.#r(t)+1]=s}insert(t,e){this.remove(e);const s=this.#n(t);s===r?this.#l(t,e):this.#c(t,s,e)}insertAt(t,e,s){this.remove(e);const i=this.#a(t);if(i===r)return void this.#l(t,e);if(s<=0)return void this.#d(t,i,e);let o=0,a=i;for(;a!==r&&o<s;)a=this.#h(a),o++;a===r?this.insert(t,e):this.#d(t,a,e)}forEach(t){let e=0;for(;;){t(e);const s=this.#a(e);if(s===r)for(;;){if(0===e)return;const t=this.#h(e);if(t!==r){e=t;break}e=this.parent(e)}else e=s}}sortChildren(t,e){let s=0,i=this.#a(t);for(;i!==r;)s++,i=this.#h(i);if(s<=1)return;let o=1;for(;o<s;){let s=r,i=r,a=this.#a(t);for(;a!==r;){let n=a,h=1;for(;h<o&&this.#h(a)!==r;)a=this.#h(a),h++;let l=this.#h(a);const c=l;this.#o[this.#r(a)+4]=r,l!==r&&(this.#o[this.#r(l)+3]=r);let d=c;for(h=0;h<o&&d!==r;)d=this.#h(d),h++;if(d!==r){const t=this.#o[this.#r(d)+3];t!==r&&(this.#o[this.#r(t)+4]=r),this.#o[this.#r(d)+3]=r}a=d;let u=r,g=r,m=n,p=l;for(;m!==r||p!==r;){let s=!1;s=p===r||m!==r&&e(m)<=e(p);const i=s?m:p;s?m=this.#h(m):p=this.#h(p);const o=this.#r(i);this.#o[o+3]=g,this.#o[o+4]=r,this.#o[o+0]=t,u===r?u=i:this.#o[this.#r(g)+4]=i,g=i}s===r?s=u:(this.#o[this.#r(i)+4]=u,this.#o[this.#r(u)+3]=i),i=g}const n=this.#r(t);this.#o[n+1]=s,this.#o[n+2]=i,o<<=1}}}class a{#u;#i;#g;constructor(t,e,s){this.#u=new Uint32Array(t,e,2),this.#i=new Uint32Array(t,e+2*Uint32Array.BYTES_PER_ELEMENT,s),this.#g=s}static bytesRequired(t){return(2+t)*Uint32Array.BYTES_PER_ELEMENT}get byteLength(){return this.#u.byteLength+this.#i.byteLength}enqueue(t){const e=this.#u[1];this.#i[e]=t,this.#u[1]=(e+1)%this.#g}dequeue(){const t=this.#u[0];return this.#u[0]=(t+1)%this.#g,this.#i[t]}}class n{#m;constructor(t,e,s){this.#m=new a(t,e,s-1)}static bytesRequired(t){return a.bytesRequired(t-1)}get byteLength(){return this.#m.byteLength}alloc(){return this.#m.dequeue()}free(t){this.#m.enqueue(t)}}class h{#p;#f;#y;#v;#L;constructor(t,r,a,h,l){this.#p=new n(t,0,l);let c=this.#p.byteLength;this.#f=new o(t,c,l),c+=this.#f.byteLength,this.#y=new e(t,c,r,l),c+=this.#y.byteLength,this.#v=new i(t,c,a,l),c+=this.#v.byteLength,this.#L=new s(t,c,h,l)}static bytesRequired(t,r,a,h){return n.bytesRequired(h)+o.bytesRequired(h)+e.bytesRequired(t,h)+i.bytesRequired(r,h)+s.bytesRequired(a,h)}newChild(t){const e=this.#p.alloc();return this.#f.insert(t,e),e}getParent(t){return this.#f.parent(t)}insertAt(t,e,s){this.#f.insertAt(t,e,s)}remove(t){this.#f.remove(t),this.#p.free(t)}setBoolean(t,e,s){this.#y.set(t,e,s)}getBoolean(t,e){return this.#y.get(t,e)}setUint32(t,e,s){this.#v.set(t,e,s)}getUint32(t,e){return this.#v.get(t,e)}setFloat32(t,e,s){this.#L.set(t,e,s)}getFloat32(t,e){return this.#L.get(t,e)}forEach(t){this.#f.forEach(t)}sortChildren(t,e){this.#f.sortChildren(t,t=>this.#v.get(t,e))}}const l=1e6;class c extends h{constructor(t){super(t,0,4,18,l)}static bytesRequired(){return h.bytesRequired(0,4,18,l)}setObjectType(t,e){this.setUint32(t,0,e)}getObjectType(t){return this.getUint32(t,0)}setLocalX(t,e){this.setFloat32(t,0,e)}getLocalX(t){return this.getFloat32(t,0)}setLocalY(t,e){this.setFloat32(t,1,e)}getLocalY(t){return this.getFloat32(t,1)}setLocalScaleX(t,e){this.setFloat32(t,2,e)}getLocalScaleX(t){return this.getFloat32(t,2)}setLocalScaleY(t,e){this.setFloat32(t,3,e)}getLocalScaleY(t){return this.getFloat32(t,3)}setLocalPivotX(t,e){this.setFloat32(t,4,e)}getLocalPivotX(t){return this.getFloat32(t,4)}setLocalPivotY(t,e){this.setFloat32(t,5,e)}getLocalPivotY(t){return this.getFloat32(t,5)}setLocalRotation(t,e){this.setFloat32(t,6,e)}getLocalRotation(t){return this.getFloat32(t,6)}setLocalCos(t,e){this.setFloat32(t,7,e)}getLocalCos(t){return this.getFloat32(t,7)}setLocalSin(t,e){this.setFloat32(t,8,e)}getLocalSin(t){return this.getFloat32(t,8)}setLocalAlpha(t,e){this.setFloat32(t,9,e)}getLocalAlpha(t){return this.getFloat32(t,9)}setWorldX(t,e){this.setFloat32(t,10,e)}getWorldX(t){return this.getFloat32(t,10)}setWorldY(t,e){this.setFloat32(t,11,e)}getWorldY(t){return this.getFloat32(t,11)}setWorldScaleX(t,e){this.setFloat32(t,12,e)}getWorldScaleX(t){return this.getFloat32(t,12)}setWorldScaleY(t,e){this.setFloat32(t,13,e)}getWorldScaleY(t){return this.getFloat32(t,13)}setWorldRotation(t,e){this.setFloat32(t,14,e)}getWorldRotation(t){return this.getFloat32(t,14)}setWorldCos(t,e){this.setFloat32(t,15,e)}getWorldCos(t){return this.getFloat32(t,15)}setWorldSin(t,e){this.setFloat32(t,16,e)}getWorldSin(t){return this.getFloat32(t,16)}setWorldAlpha(t,e){this.setFloat32(t,17,e)}getWorldAlpha(t){return this.getFloat32(t,17)}setLayer(t,e){this.setUint32(t,1,e)}getLayer(t){return this.getUint32(t,1)}setAssetId(t,e){this.setUint32(t,2,e)}getAssetId(t){return this.getUint32(t,2)}setAnimationId(t,e){this.setUint32(t,3,e)}getAnimationId(t){return this.getUint32(t,3)}setWorldId(t,e){this.setUint32(t,2,e)}getWorldId(t){return this.getUint32(t,2)}setBodyId(t,e){this.setUint32(t,2,e)}getBodyId(t){return this.getUint32(t,2)}}var d,u,g,m;(g=d||(d={}))[g.GameObject=0]="GameObject",g[g.Sprite=1]="Sprite",g[g.AnimatedSprite=2]="AnimatedSprite",g[g.PhysicsWorld=3]="PhysicsWorld",g[g.PhysicsObject=4]="PhysicsObject";class p{#T;#b=0;constructor(t,e){this.#T=void 0!==e&&e>0?e:void 0;let s=performance.now(),i=0;const r=e=>{const o=(e-s)/1e3;if(o>0){const r=this.#T;if(void 0!==r&&r>0){i+=o;const e=1/r;i>=e&&(t(e),i>=2*e?(t(o),i=0):i-=e)}else t(o);s=e}this.#b=requestAnimationFrame(r)};this.#b=requestAnimationFrame(r)}setFpsCap(t){this.#T=t>0?t:void 0}disableFpsCap(){this.#T=void 0}remove(){cancelAnimationFrame(this.#b)}}class f{#F={};on(t,e){return this.#F[t]||(this.#F[t]=[]),this.#F[t].push({listener:e}),this}once(t,e){return this.#F[t]||(this.#F[t]=[]),this.#F[t].push({listener:e,once:!0}),this}off(t,e){const s=this.#F[t];return s?(this.#F[t]=s.filter(t=>t.listener!==e),0===this.#F[t].length&&delete this.#F[t],this):this}async emit(t,...e){const s=this.#F[t];if(!s)return[];const i=[],r=[];for(const o of s){const s=o.listener(...e);o.once&&this.off(t,o.listener),s instanceof Promise?r.push(s):i.push(s)}return i.concat(await Promise.all(r))}#S=[];bindTo(t,e,s){this.on(e,s);const i=()=>{this.off(e,s);const i=this.#S.findIndex(i=>i.target===t&&i.key===e&&i.listener===s);-1!==i&&this.#S.splice(i,1)};return t.on("remove",i),this.#S.push({key:e,target:t,listener:s,removeHandler:i}),this}remove(){this.emit("remove");for(const t of this.#S)t.target.off("remove",t.removeHandler);this.#S.length=0}}class y extends f{#P;children=[];paused=!1;set parent(t){this.#P=t}get parent(){return this.#P}add(...t){for(const e of t){if(e.#P){const t=e.#P.children.indexOf(e);-1!==t&&e.#P.children.splice(t,1)}e.parent=this,this.children.push(e)}}remove(){if(super.remove(),this.#P){const t=this.#P.children.indexOf(this);-1!==t&&this.#P.children.splice(t,1),this.#P=void 0}for(const t of this.children)t.parent=void 0,t.remove();this.children.length=0}pause(){this.paused=!0;for(const t of this.children)t.pause()}resume(){this.paused=!1;for(const t of this.children)t.resume()}update(t){if(!this.paused){for(const e of this.children)e.paused||e.update(t);this.emit("update",t)}}}class v{#A;#Y;#C=0;#x=0;#E=1;#I=1;#X=0;#w=0;#R=0;cos=1;sin=0;get x(){return this.#C}set x(t){if(this.#C!==t){this.#C=t;const e=this.#A,s=this.#Y;s&&void 0!==e&&s.setLocalX(e,t)}}get y(){return this.#x}set y(t){if(this.#x!==t){this.#x=t;const e=this.#A,s=this.#Y;s&&void 0!==e&&s.setLocalY(e,t)}}get scaleX(){return this.#E}set scaleX(t){if(this.#E!==t){this.#E=t;const e=this.#A,s=this.#Y;s&&void 0!==e&&s.setLocalScaleX(e,t)}}get scaleY(){return this.#I}set scaleY(t){if(this.#I!==t){this.#I=t;const e=this.#A,s=this.#Y;s&&void 0!==e&&s.setLocalScaleY(e,t)}}get pivotX(){return this.#X}set pivotX(t){if(this.#X!==t){this.#X=t;const e=this.#A,s=this.#Y;s&&void 0!==e&&s.setLocalPivotX(e,t)}}get pivotY(){return this.#w}set pivotY(t){if(this.#w!==t){this.#w=t;const e=this.#A,s=this.#Y;s&&void 0!==e&&s.setLocalPivotY(e,t)}}get rotation(){return this.#R}set rotation(t){if(this.#R!==t){this.#R=t;const e=Math.cos(t),s=Math.sin(t);this.cos=e,this.sin=s;const i=this.#A,r=this.#Y;r&&void 0!==i&&(r.setLocalRotation(i,t),r.setLocalCos(i,e),r.setLocalSin(i,s))}}setStateTree(t,e){this.#A=t,this.#Y=e,e.setLocalX(t,this.#C),e.setLocalY(t,this.#x),e.setLocalScaleX(t,this.#E),e.setLocalScaleY(t,this.#I),e.setLocalPivotX(t,this.#X),e.setLocalPivotY(t,this.#w),e.setLocalRotation(t,this.#R),e.setLocalCos(t,this.cos),e.setLocalSin(t,this.sin)}clearStateTree(){this.#A=void 0,this.#Y=void 0}}function L(t){return void 0!==t.attachToStateTree}class T extends y{type=d.GameObject;#A;#Y;#q=new v;alpha=1;#U=0;_rootConfig(t,e){this.#A=t,this.#Y=e}constructor(t){super(),t&&(void 0!==t.x&&(this.x=t.x),void 0!==t.y&&(this.y=t.y),void 0!==t.layer&&(this.layer=t.layer))}attachToStateTree(t,e){this.#W();const s=e.newChild(t);e.setObjectType(s,this.type),e.setLocalAlpha(s,this.alpha),this.#A=s,this.#Y=e,this.#q.setStateTree(s,e),e.setLayer(s,this.#U);for(const t of this.children)L(t)&&t.attachToStateTree(s,e);return s}#W(){void 0!==this.#A&&this.#Y&&this.#Y.remove(this.#A),this.#A=void 0,this.#Y=void 0,this.#q.clearStateTree()}add(...t){if(super.add(...t),void 0!==this.#A&&this.#Y)for(const e of t)L(e)&&e.attachToStateTree(this.#A,this.#Y)}remove(){this.#W(),super.remove()}set x(t){this.#q.x=t}get x(){return this.#q.x}set y(t){this.#q.y=t}get y(){return this.#q.y}set layer(t){this.#U!==t&&(this.#U=t,void 0!==this.#A&&this.#Y&&this.#Y.setLayer(this.#A,t))}get layer(){return this.#U}}class b extends T{constructor(t){super(),this._rootConfig(0,t),t.setWorldScaleX(0,1),t.setWorldScaleY(0,1),t.setWorldCos(0,1),t.setWorldAlpha(0,1)}}class F extends T{type=d.AnimatedSprite;#B;#k;constructor(t){super(t),this.#B=t.asset,this.#k=t.animation}attachToStateTree(t,e){const s=super.attachToStateTree(t,e);return e.setAssetId(s,this.#B),e.setAnimationId(s,this.#k),s}}class S extends T{type=d.Sprite;#B;constructor(t){super(t),this.#B=t.asset}attachToStateTree(t,e){const s=super.attachToStateTree(t,e);return e.setAssetId(s,this.#B),s}}let P,A;!function(t){t[t.Fire=0]="Fire"}(u||(u={})),u.Fire,function(t){t[t.Bird=0]="Bird",t[t.Fire=1]="Fire"}(m||(m={})),m.Bird,m.Fire,t=!0;let Y=0;onmessage=t=>{const e=t.data.type;"init"===e&&function(t){A=new b(t);for(let t=0;t<100;t++){const t=new S({asset:m.Bird,x:800*Math.random()-400,y:600*Math.random()-300});A.add(t)}const e=new F({asset:m.Fire,animation:u.Fire});A.add(e),P=new p(t=>{Y=1/t,A.update(t)}),setInterval(()=>{postMessage({type:"fps",value:Y})},1e3)}(new c(t.data.sab)),"setFpsCap"===e&&P.setFpsCap(t.data.fps)}})();