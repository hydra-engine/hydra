(()=>{"use strict";const t=4294967295;let e=!1;class s{#t;#e;constructor(t,e,s,i){this.#e=s;const o=s*i,r=Math.ceil(o/32);this.#t=new Uint32Array(t,e,r)}static bytesRequired(t,e){const s=t*e;return Math.ceil(s/32)*Uint32Array.BYTES_PER_ELEMENT}get byteLength(){return this.#t.byteLength}#s(t,e){return t*this.#e+e}set(t,e,s){const i=this.#s(t,e),o=i>>>5,r=1<<(31&i);s?this.#t[o]|=r:this.#t[o]&=~r}get(t,e){const s=this.#s(t,e),i=s>>>5,o=1<<(31&s);return 0!==(this.#t[i]&o)}}class i{#i;#e;constructor(t,e,s,i){this.#e=s,this.#i=new Float32Array(t,e,s*i)}static bytesRequired(t,e){return t*e*Float32Array.BYTES_PER_ELEMENT}get byteLength(){return this.#i.byteLength}#o(t){return t*this.#e}set(t,e,s){this.#i[this.#o(t)+e]=s}get(t,e){return this.#i[this.#o(t)+e]}}class o{#i;#e;constructor(t,e,s,i){this.#e=s,this.#i=new Uint32Array(t,e,s*i)}static bytesRequired(t,e){return t*e*Uint32Array.BYTES_PER_ELEMENT}get byteLength(){return this.#i.byteLength}#o(t){return t*this.#e}set(t,e,s){this.#i[this.#o(t)+e]=s}get(t,e){return this.#i[this.#o(t)+e]}}class r{#r;constructor(t,e,s){this.#r=new Uint32Array(t,e,5*s)}static bytesRequired(t){return 5*t*Uint32Array.BYTES_PER_ELEMENT}get byteLength(){return this.#r.byteLength}#o(t){return 5*t}parent(t){return this.#r[this.#o(t)+0]}#a(t){return this.#r[this.#o(t)+1]}#n(t){return this.#r[this.#o(t)+2]}#h(t){return this.#r[this.#o(t)+4]}remove(e){const s=this.#o(e),i=this.#r[s+0],o=this.#r[s+3],r=this.#r[s+4];if(i!==t){const t=this.#o(i);this.#r[t+1]===e&&(this.#r[t+1]=r),this.#r[t+2]===e&&(this.#r[t+2]=o)}o!==t&&(this.#r[this.#o(o)+4]=r),r!==t&&(this.#r[this.#o(r)+3]=o)}#l(e,s){const i=this.#o(e),o=this.#o(s);this.#r[o+0]=e,this.#r[o+3]=t,this.#r[o+4]=t,this.#r[i+1]=s,this.#r[i+2]=s}#c(e,s,i){const o=this.#o(s),r=this.#r[o+4],a=this.#o(i);this.#r[a+0]=e,this.#r[a+3]=s,this.#r[a+4]=r,this.#r[o+4]=i,r!==t?this.#r[this.#o(r)+3]=i:this.#r[this.#o(e)+2]=i}#g(e,s,i){const o=this.#o(s),r=this.#r[o+3],a=this.#o(i);this.#r[a+0]=e,this.#r[a+4]=s,this.#r[a+3]=r,this.#r[o+3]=i,r!==t?this.#r[this.#o(r)+4]=i:this.#r[this.#o(e)+1]=i}insert(e,s){this.remove(s);const i=this.#n(e);i===t?this.#l(e,s):this.#c(e,i,s)}insertAt(e,s,i){this.remove(s);const o=this.#a(e);if(o===t)return void this.#l(e,s);if(i<=0)return void this.#g(e,o,s);let r=0,a=o;for(;a!==t&&r<i;)a=this.#h(a),r++;a===t?this.insert(e,s):this.#g(e,a,s)}forEach(e){let s=0;for(;;){e(s);const i=this.#a(s);if(i===t)for(;;){if(0===s)return;const e=this.#h(s);if(e!==t){s=e;break}s=this.parent(s)}else s=i}}sortChildren(e,s){let i=this.#a(e);if(i===t||this.#h(i)===t)return;const o=[];let r=i;for(;r!==t;)o.push(r),r=this.#h(r);o.sort((t,e)=>s(t)-s(e));const a=this.#o(e);this.#r[a+1]=o[0],this.#r[a+2]=o[o.length-1];for(let s=0;s<o.length;s++){const i=o[s],r=this.#o(i),a=s>0?o[s-1]:t,n=s<o.length-1?o[s+1]:t;this.#r[r+0]=e,this.#r[r+3]=a,this.#r[r+4]=n}}}class a{#u;#i;#d;constructor(t,e,s){this.#u=new Uint32Array(t,e,2),this.#i=new Uint32Array(t,e+2*Uint32Array.BYTES_PER_ELEMENT,s),this.#d=s}static bytesRequired(t){return(2+t)*Uint32Array.BYTES_PER_ELEMENT}get byteLength(){return this.#u.byteLength+this.#i.byteLength}enqueue(t){const e=this.#u[1];this.#i[e]=t,this.#u[1]=(e+1)%this.#d}dequeue(){const t=this.#u[0];return this.#u[0]=(t+1)%this.#d,this.#i[t]}}class n{#m;constructor(t,e,s){this.#m=new a(t,e,s-1)}static bytesRequired(t){return a.bytesRequired(t-1)}get byteLength(){return this.#m.byteLength}alloc(){return this.#m.dequeue()}free(t){this.#m.enqueue(t)}}class h{#y;#F;#L;#b;#p;constructor(t,e,a,h,l){this.#y=new n(t,0,l);let c=this.#y.byteLength;this.#F=new r(t,c,l),c+=this.#F.byteLength,this.#L=new s(t,c,e,l),c+=this.#L.byteLength,this.#b=new o(t,c,a,l),c+=this.#b.byteLength,this.#p=new i(t,c,h,l)}static bytesRequired(t,e,a,h){return n.bytesRequired(h)+r.bytesRequired(h)+s.bytesRequired(t,h)+o.bytesRequired(e,h)+i.bytesRequired(a,h)}newChild(t){const e=this.#y.alloc();return this.#F.insert(t,e),e}getParent(t){return this.#F.parent(t)}insertAt(t,e,s){this.#F.insertAt(t,e,s)}remove(t){this.#F.remove(t),this.#y.free(t)}setBoolean(t,e,s){this.#L.set(t,e,s)}getBoolean(t,e){return this.#L.get(t,e)}setUint32(t,e,s){this.#b.set(t,e,s)}getUint32(t,e){return this.#b.get(t,e)}setFloat32(t,e,s){this.#p.set(t,e,s)}getFloat32(t,e){return this.#p.get(t,e)}forEach(t){this.#F.forEach(t)}sortChildren(t,e){this.#F.sortChildren(t,e)}}const l=1e6;class c extends h{constructor(t){super(t,0,5,23,l)}static bytesRequired(){return h.bytesRequired(0,5,23,l)}setObjectType(t,e){this.setUint32(t,0,e)}getObjectType(t){return this.getUint32(t,0)}setLocalX(t,e){this.setFloat32(t,1,e)}getLocalX(t){return this.getFloat32(t,1)}setLocalY(t,e){this.setFloat32(t,2,e)}getLocalY(t){return this.getFloat32(t,2)}setLocalScaleX(t,e){this.setFloat32(t,3,e)}getLocalScaleX(t){return this.getFloat32(t,3)}setLocalScaleY(t,e){this.setFloat32(t,4,e)}getLocalScaleY(t){return this.getFloat32(t,4)}setLocalPivotX(t,e){this.setFloat32(t,5,e)}getLocalPivotX(t){return this.getFloat32(t,5)}setLocalPivotY(t,e){this.setFloat32(t,6,e)}getLocalPivotY(t){return this.getFloat32(t,6)}setLocalRotation(t,e){this.setFloat32(t,7,e)}getLocalRotation(t){return this.getFloat32(t,7)}setLocalCos(t,e){this.setFloat32(t,8,e)}getLocalCos(t){return this.getFloat32(t,8)}setLocalSin(t,e){this.setFloat32(t,9,e)}getLocalSin(t){return this.getFloat32(t,9)}setLocalAlpha(t,e){this.setFloat32(t,10,e)}getLocalAlpha(t){return this.getFloat32(t,10)}setWorldX(t,e){this.setFloat32(t,11,e)}getWorldX(t){return this.getFloat32(t,11)}setWorldY(t,e){this.setFloat32(t,12,e)}getWorldY(t){return this.getFloat32(t,12)}setWorldScaleX(t,e){this.setFloat32(t,13,e)}getWorldScaleX(t){return this.getFloat32(t,13)}setWorldScaleY(t,e){this.setFloat32(t,14,e)}getWorldScaleY(t){return this.getFloat32(t,14)}setWorldRotation(t,e){this.setFloat32(t,15,e)}getWorldRotation(t){return this.getFloat32(t,15)}setWorldCos(t,e){this.setFloat32(t,16,e)}getWorldCos(t){return this.getFloat32(t,16)}setWorldSin(t,e){this.setFloat32(t,17,e)}getWorldSin(t){return this.getFloat32(t,17)}setWorldAlpha(t,e){this.setFloat32(t,18,e)}getWorldAlpha(t){return this.getFloat32(t,18)}setLayer(t,e){this.setUint32(t,1,e)}getLayer(t){return this.getUint32(t,1)}setDrawOrder(t,e){this.setFloat32(t,0,e)}getDrawOrder(t){return this.getFloat32(t,0)}setTint(t,e){this.setUint32(t,2,e)}getTint(t){return this.getUint32(t,2)}setAssetId(t,e){this.setUint32(t,3,e)}getAssetId(t){return this.getUint32(t,3)}setAnimationId(t,e){this.setUint32(t,4,e)}getAnimationId(t){return this.getUint32(t,4)}setShapeId(t,e){this.setUint32(t,3,e)}getShapeId(t){return this.getUint32(t,3)}setRadius(t,e){this.setFloat32(t,19,e)}getRadius(t){return this.getFloat32(t,19)}setWidth(t,e){this.setFloat32(t,19,e)}getWidth(t){return this.getFloat32(t,19)}setHeight(t,e){this.setFloat32(t,20,e)}getHeight(t){return this.getFloat32(t,20)}setWorldId(t,e){this.setUint32(t,3,e)}getWorldId(t){return this.getUint32(t,3)}setBodyId(t,e){this.setUint32(t,3,e)}getBodyId(t){return this.getUint32(t,3)}setVelocityX(t,e){this.setFloat32(t,19,e)}getVelocityX(t){return this.getFloat32(t,19)}setVelocityY(t,e){this.setFloat32(t,20,e)}getVelocityY(t){return this.getFloat32(t,20)}setTargetX(t,e){this.setFloat32(t,21,e)}getTargetX(t){return this.getFloat32(t,21)}setTargetY(t,e){this.setFloat32(t,22,e)}getTargetY(t){return this.getFloat32(t,22)}#f=t=>this.getDrawOrder(t);sortChildren(t){super.sortChildren(t,this.#f)}}var g,u;!function(t){t[t.GameObject=0]="GameObject",t[t.Sprite=1]="Sprite",t[t.AnimatedSprite=2]="AnimatedSprite",t[t.Rectangle=3]="Rectangle",t[t.Circle=4]="Circle",t[t.BitmapText=5]="BitmapText",t[t.PhysicsWorld=6]="PhysicsWorld",t[t.PhysicsObject=7]="PhysicsObject"}(g||(g={}));class d{#C;#S=0;constructor(t,e){this.#C=void 0!==e&&e>0?e:void 0;let s=performance.now(),i=0;const o=e=>{const r=(e-s)/1e3;if(r>0){const o=this.#C;if(void 0!==o&&o>0){i+=r;const e=1/o;i>=e&&(t(e),i>=2*e?(t(r),i=0):i-=e)}else t(r);s=e}this.#S=requestAnimationFrame(o)};this.#S=requestAnimationFrame(o)}setFpsCap(t){this.#C=t>0?t:void 0}disableFpsCap(){this.#C=void 0}remove(){cancelAnimationFrame(this.#S)}}let m;!function(t){t[t.Rectangle=0]="Rectangle",t[t.Circle=1]="Circle",t[t.Polygon=2]="Polygon"}(u||(u={})),e=!0;let y=0;onmessage=async({data:e})=>{const s=e.type;var i;"init"===s&&(i=new c(e.sab),m=new d(e=>{y=1/e,function(e,s){e.forEach(i=>{const o=e.getParent(i);if(o===t)return;const r=e.getTargetX(i),a=e.getTargetY(i);if(!isNaN(r)||!isNaN(a)){const t=1-Math.exp(-100*s);if(!isNaN(r)){const s=e.getLocalX(i),o=s+(r-s)*t;e.setLocalX(i,o),Math.abs(r-o)<=.001&&e.setLocalX(i,r)}if(!isNaN(a)){const s=e.getLocalY(i),o=s+(a-s)*t;e.setLocalY(i,o),Math.abs(a-o)<=.001&&e.setLocalY(i,a)}}const n=e.getWorldCos(o),h=e.getWorldSin(o),l=e.getWorldX(o),c=e.getWorldY(o),g=e.getLocalX(i)*e.getWorldScaleX(o),u=e.getLocalY(i)*e.getWorldScaleY(o),d=e.getWorldScaleX(o)*e.getLocalScaleX(i),m=e.getWorldScaleY(o)*e.getLocalScaleY(i);e.setWorldScaleX(i,d),e.setWorldScaleY(i,m);const y=e.getLocalCos(i),F=e.getLocalSin(i),L=n*y-h*F,b=h*y+n*F,p=e.getWorldRotation(o)+e.getLocalRotation(i);e.setWorldRotation(i,p),e.setWorldCos(i,L),e.setWorldSin(i,b);const f=e.getLocalPivotX(i)*d,C=e.getLocalPivotY(i)*m,S=l+(g*n-u*h)-(f*L-C*b),W=c+(g*h+u*n)-(f*b+C*L);e.setWorldX(i,S),e.setWorldY(i,W),e.setWorldAlpha(i,e.getWorldAlpha(o)*e.getLocalAlpha(i))})}(i,e)}),setInterval(()=>{postMessage({type:"fps",value:y})},1e3)),"setFpsCap"===s&&m.setFpsCap(e.fps)}})();